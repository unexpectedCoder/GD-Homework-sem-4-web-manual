
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Реализуем алгоритм решения задачи &#8212; GD Homework sem 4</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'solver';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Газодинамические функции" href="gas-dynamics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="GD Homework sem 4 - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="GD Homework sem 4 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    О пособии
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="task.html">Задача</a></li>
<li class="toctree-l1"><a class="reference internal" href="nozzle.html">Расчёт геометрии сопла</a></li>
<li class="toctree-l1"><a class="reference internal" href="gas-dynamics.html">Газодинамические функции</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Реализуем алгоритм решения задачи</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/unexpectedCoder/GD-Homework-sem-4-web-manual" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/unexpectedCoder/GD-Homework-sem-4-web-manual/issues/new?title=Issue%20on%20page%20%2Fsolver.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/solver.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Реализуем алгоритм решения задачи</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Класс результатов решения <code class="docutils literal notranslate"><span class="pre">Solution</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Решающая функция</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Тестовый расчёт</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Визуализация результатов</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Пересчёт длины сопла для обеспечения расчётного режима его работы</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Реализуем алгоритм решения задачи<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<p>Начнём с того, что определимся с кодовой структурой алгоритма.
Пусть за решение задачи отвечает функция с говорящим названием <code class="docutils literal notranslate"><span class="pre">solve</span></code> и пусть на вход она принимает экземпляр задачи <code class="docutils literal notranslate"><span class="pre">Task</span></code>, сопла <code class="docutils literal notranslate"><span class="pre">Nozzle</span></code> и величину давления окружающей среды.</p>
<p>В качестве возвращаемого значения хотелось бы получить ответы на все вопросы задания.
Но их достаточно много (различные тяги, скорости и т.д.).
Поэтому заведём ещё один класс данных (dataclass), назовём его <code class="docutils literal notranslate"><span class="pre">Solution</span></code>.
Так пусть <code class="docutils literal notranslate"><span class="pre">solve</span></code> возвращает экземпляр этого класса.</p>
<p>Другими словами, мы напишем функцию со следующей <em>сигнатурой</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">noz</span><span class="p">:</span> <span class="n">Nozzle</span><span class="p">,</span> <span class="n">p_a</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solution</span><span class="p">:</span>
</pre></div>
</div>
<p>Сведём воедино весь код, который мы до сих пор написали:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="n">pi</span>


<span class="c1"># Описание задачи</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># &quot;Заморозили&quot; класс - у экземпляра невозможно будет изменять значения полей</span>
<span class="k">class</span> <span class="nc">Task</span><span class="p">:</span>             <span class="c1"># (это защитит нас от случайных изменений данных).</span>
    <span class="n">variant</span><span class="p">:</span> <span class="nb">float</span>          <span class="c1"># № варианта</span>
    <span class="n">p0</span><span class="p">:</span> <span class="nb">float</span>               <span class="c1"># float - тип данных (вещественное число)</span>
    <span class="n">T0</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">R</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">k</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">d_critic</span><span class="p">:</span> <span class="nb">float</span>         <span class="c1"># Обратите внимание:</span>
    <span class="n">area_ratio</span><span class="p">:</span> <span class="nb">float</span>       <span class="c1"># в коде лучше использовать более говорящие</span>
    <span class="n">d_chamber</span><span class="p">:</span> <span class="nb">float</span>        <span class="c1"># имена переменных, чем принято в математике.</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span>            <span class="c1"># Это улучшает читаемость кода (в первую очередь, для вас самих).</span>
    <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span>             <span class="c1"># В целом наша задача чисто расчётная и в ней не так много переменных,</span>
    <span class="n">rel_propel_mass</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># поэтому ряд значений мы обозначили близко к математике в методичке.</span>


<span class="c1"># Описание сопла</span>
<span class="k">class</span> <span class="nc">Nozzle</span><span class="p">:</span>
    <span class="c1"># __init__ - это конструктор экземпляра класса,</span>
    <span class="c1"># т.е. тот код, который выполняется при создании объекта класса</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">d_chamber</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">d_critic</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">area_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">confuser_angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">diffuser_angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_chamber</span> <span class="o">=</span> <span class="n">d_chamber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span> <span class="o">=</span> <span class="n">d_critic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_ratio</span> <span class="o">=</span> <span class="n">area_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">confuser_angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">diffuser_angle</span>
        <span class="c1"># Расчётные параметры вынесем в отдельный приватный метод</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_geometry</span><span class="p">()</span>
    
    <span class="c1"># Данный метод является приватным - его имя начинается с _.</span>
    <span class="c1"># Вне класса этот метод напрямую недоступен.</span>
    <span class="k">def</span> <span class="nf">_init_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Выполняем расчёт по формулам.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_chamber</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span><span class="p">)</span> <span class="o">/</span> <span class="n">tan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span><span class="p">)</span> <span class="o">/</span> <span class="n">tan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_critic</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># Метод для расчёта d(x)</span>
    <span class="k">def</span> <span class="nf">diameter_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">confuser</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span>
        <span class="n">d</span><span class="p">[</span><span class="n">confuser</span><span class="p">]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">d_chamber</span> \
            <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_chamber</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">confuser</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span>
        <span class="n">diffuser</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span>
        <span class="n">d</span><span class="p">[</span><span class="n">diffuser</span><span class="p">]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span> \
            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_critic</span><span class="p">)</span> \
            <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">diffuser</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_critic</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>


<span class="c1"># Газодинамические функции</span>
<span class="k">def</span> <span class="nf">temp_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mach</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">dens_ration</span><span class="p">(</span><span class="n">mach</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">temp_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">press_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">temp_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">square_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">mach</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="n">a</span> <span class="o">*</span> <span class="n">temp_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="n">a</span>

<span class="k">def</span> <span class="nf">lambda2mach</span><span class="p">(</span><span class="n">lam</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">lam</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">mach2lambda</span><span class="p">(</span><span class="n">mach</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mach</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">temp_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">sonic</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="solution">
<h2>Класс результатов решения <code class="docutils literal notranslate"><span class="pre">Solution</span></code><a class="headerlink" href="#solution" title="Link to this heading">#</a></h2>
<p>В результате решения первой части задания (до задачи приведения геометрии сопла под расчётный режим) должны быть построены графики <span class="math notranslate nohighlight">\(p(x)\)</span>, <span class="math notranslate nohighlight">\(\rho(x)\)</span>, <span class="math notranslate nohighlight">\(T(x)\)</span>, <span class="math notranslate nohighlight">\(S(x)\)</span>, <span class="math notranslate nohighlight">\(j(x)\)</span>, <span class="math notranslate nohighlight">\(G(x) = j(x) S(x)\)</span>, <span class="math notranslate nohighlight">\(\mathrm{M}(x)\)</span>, <span class="math notranslate nohighlight">\(\lambda(x)\)</span> и рассчитаны величины <span class="math notranslate nohighlight">\(G\)</span> (постоянный массовый расход), тяги <span class="math notranslate nohighlight">\(P\)</span>, <span class="math notranslate nohighlight">\(P_\mathrm{уд}\)</span>, <span class="math notranslate nohighlight">\(P_\mathrm{вак}\)</span> и <span class="math notranslate nohighlight">\(P_\mathrm{уд.вак}\)</span>, скорость газа на выходе <span class="math notranslate nohighlight">\(v_\mathrm{в}\)</span>, давление газа на выходе <span class="math notranslate nohighlight">\(p_\mathrm{в}\)</span>, скорость идеальной ракеты <span class="math notranslate nohighlight">\(v\)</span>, степень нерасчётности сопла <span class="math notranslate nohighlight">\(\Delta_p\)</span>.</p>
<p>Пусть эти данные хранятся в классе <code class="docutils literal notranslate"><span class="pre">Solution</span></code>.
Для разнообразия и общего развития сделаем возможность читабельного вывода экземпляра решения, добавив метод <code class="docutils literal notranslate"><span class="pre">as_dict</span></code>, который возвращает поля экземпляра в виде Python-словаря.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Описание решения</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>               <span class="c1"># массив координат расчётных точек</span>
    <span class="n">square</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>          <span class="c1"># массив площадей сечений в точках x</span>
    <span class="n">mach</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>            <span class="c1"># массив чисел Маха</span>
    <span class="n">pressure</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>        <span class="c1"># массив значений статического давления</span>
    <span class="n">density</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>         <span class="c1"># ... плотности</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>     <span class="c1"># ... температуры</span>
    <span class="n">specific_mass</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>   <span class="c1"># ... плотности потока массы</span>
    <span class="n">mass_consumption</span><span class="p">:</span> <span class="nb">float</span>     <span class="c1"># массовый расход</span>
    <span class="n">speed_out</span><span class="p">:</span> <span class="nb">float</span>            <span class="c1"># скорость газа на выходе</span>
    <span class="n">pressure_out</span><span class="p">:</span> <span class="nb">float</span>         <span class="c1"># давление на выходе</span>
    <span class="n">thrust</span><span class="p">:</span> <span class="nb">float</span>               <span class="c1"># тяга</span>
    <span class="n">thrust_specific</span><span class="p">:</span> <span class="nb">float</span>      <span class="c1"># удельная тяга</span>
    <span class="n">thrust_space</span><span class="p">:</span> <span class="nb">float</span>         <span class="c1"># тяга в пустоте</span>
    <span class="n">thrust_specific_space</span><span class="p">:</span> <span class="nb">float</span>    <span class="c1"># удельная тяга в пустоте</span>
    <span class="n">ideal_speed</span><span class="p">:</span> <span class="nb">float</span>          <span class="c1"># скорость идеальной ракеты</span>
    <span class="n">adapted_level</span><span class="p">:</span> <span class="nb">float</span>        <span class="c1"># степень нерасчётности сопла</span>

    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Массовый расход, кг/с&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_consumption</span><span class="p">),</span>
            <span class="s2">&quot;Скорость потока на выходе, м/с&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_out</span><span class="p">),</span>
            <span class="s2">&quot;Давление на выходе, Па&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_out</span><span class="p">),</span>
            <span class="s2">&quot;Тяга, Н&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrust</span><span class="p">),</span>
            <span class="s2">&quot;Удельная тяга, м/с&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrust_specific</span><span class="p">),</span>
            <span class="s2">&quot;Тяга в пустоте, Н&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrust_space</span><span class="p">),</span>
            <span class="s2">&quot;Удельная тяга в пустоте, м/с&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrust_specific_space</span><span class="p">),</span>
            <span class="s2">&quot;Скорость идеальной ракеты, м/с&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ideal_speed</span><span class="p">),</span>
            <span class="s2">&quot;Степень нерасчётности сопла&quot;</span><span class="p">:</span> \
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adapted_level</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="p">(</span>
                    <span class="s2">&quot;(недорасширение)&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapted_level</span> <span class="o">&lt;</span> <span class="mi">1</span> 
                    <span class="k">else</span> <span class="s2">&quot;(перерасширение)&quot;</span>
                <span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h2>Решающая функция<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>Для начала вспомним, как по известной геометрии сопла определить параметры течения газа в нём.
Посмотрите уравнение (15) в <a class="reference external" href="https://press.bmstu.ru/catalog/item/7208/">методичке</a> и пояснения к нему.
Это уравнение имеет следующий вид:</p>
<div class="math notranslate nohighlight" id="equation-eq-f-m">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq-f-m" title="Link to this equation">#</a></span>\[
f(\mathrm{M}) =
S - \frac{S_*}{\mathrm{M}}
\left(
    \frac{2}{k+1}
\right)^{\cfrac{k+1}{2 (k-1)}}
\left(
    1 + \frac{k-1}{2} \mathrm{M}^2
\right)^{\cfrac{k+1}{2 (k-1)}}
= 0.
\]</div>
<p>Из этого <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%A2%D1%80%D0%B0%D0%BD%D1%81%D1%86%D0%B5%D0%BD%D0%B4%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D0%B5_%D1%83%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5"><em>трансцендентного</em></a> уравнения и находится (численно) число Маха в сечении, имеющем площадь <span class="math notranslate nohighlight">\(S\)</span>.</p>
<p>В отличие от основного пособия мы не будем использовать метод половинного деления, тем более не будем сами реализовывать метод численного поиска корня.
Это интересная алгоритмическая задача, но для нас как инженеров гораздо важнее знать возможности современных инструментов и то, что конкретно и как применять для решения той или иной задачи.
Поэтому мы воспользуемся библиотекой SciPy, в которой на низкоуровневых быстрых языках программирования реализованы различные методы поиска корней.</p>
<p>Импортируем пакет численной оптимизации <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opti</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Не пугайтесь того, что мы используем функцию из пакета для оптимизации.
В программировании поиск корня — это одна из задач оптимизации.</p>
</div>
<p>Как записать наше уравнение <span class="math notranslate nohighlight">\(f(\mathrm{M}) = 0\)</span> в коже?
Очень просто! В виде функции, возвращающей значение выражения <a class="reference internal" href="#equation-eq-f-m">(1)</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">area_equation</span><span class="p">(</span><span class="n">mach</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">s_critic</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span> <span class="o">-</span> <span class="n">s_critic</span><span class="o">*</span><span class="n">square_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Суть численного поиска корня уравнения сводится к тому, что алгоритм поиска вызывает функцию <code class="docutils literal notranslate"><span class="pre">area_equation</span></code>, передавая её начальное приближения значения числа Маха <code class="docutils literal notranslate"><span class="pre">mach</span></code> (разные алгоритмы вырабатывают это значение из разных соображений).
Функция в ответ даёт значение выражения <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">-</span> <span class="pre">s_critic*square_ratio(mach,</span> <span class="pre">k)</span></code>.
На основании этого ответа алгоритм вырабатывает новое приближение переменной <code class="docutils literal notranslate"><span class="pre">mach</span></code> и снова вызывает функцию <code class="docutils literal notranslate"><span class="pre">area_equation</span></code>.
И так до тех пор, пока <em>с заданной точностью</em> не будет выполнено равенство выражения <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">-</span> <span class="pre">s_critic*square_ratio(mach,</span> <span class="pre">k)</span></code> нулю, то есть равенство <a class="reference internal" href="#equation-eq-f-m">(1)</a>.</p>
<p>Для поиска корня будем использовать функцию <code class="docutils literal notranslate"><span class="pre">opti.root_scalar</span></code> из библиотеки SciPy.
Почитайте об этом методе в <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.root_scalar.html">официальной документации</a>.
Корень уравнения <a class="reference internal" href="#equation-eq-f-m">(1)</a> будем искать в функции <code class="docutils literal notranslate"><span class="pre">solve</span></code>.
Опишем, наконец, эту функцию:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># На входе функции у нас уже есть все необходимые данные:</span>
<span class="c1"># экземпляры задания task, сопла noz и внешнего давления p_a</span>
<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">noz</span><span class="p">:</span> <span class="n">Nozzle</span><span class="p">,</span> <span class="n">p_a</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="c1"># Создаём массив расчётных точек по оси сопла</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">noz</span><span class="o">.</span><span class="n">x_out</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
    <span class="c1"># Уже легко посчитать площади сечений</span>
    <span class="c1"># (помните, что в методе diameter_at мы позаботились</span>
    <span class="c1"># о возможности считать массивами?)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">noz</span><span class="o">.</span><span class="n">diameter_at</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># Начинаем численно искать числа Маха в сечениях</span>
    <span class="n">mach</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
        <span class="c1"># Передаём нашу функцию с уравнением,</span>
        <span class="c1"># дополнительные аргументы этой функции (args)</span>
        <span class="c1"># и bracket - диапазон поиска корня</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span>
            <span class="n">area_equation</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">noz</span><span class="o">.</span><span class="n">d_critic</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">k</span><span class="p">),</span>
            <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">xi</span> <span class="o">&lt;</span> <span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">root</span>
        <span class="c1"># Сохраняем корень</span>
        <span class="n">mach</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
    <span class="c1"># Готово! Все корни найдены.</span>
    <span class="c1"># Теперь преобразуем Python-список в массив NumPy</span>
    <span class="n">mach</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mach</span><span class="p">)</span>
    <span class="c1"># Далее по формулам рассчитываем параметры течения</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">p0</span> <span class="o">/</span> <span class="n">press_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">p0</span> <span class="o">/</span> <span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">task</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">rho0</span> <span class="o">/</span> <span class="n">dens_ration</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">T0</span> <span class="o">/</span> <span class="n">temp_ratio</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">mach</span> <span class="o">*</span> <span class="n">sonic</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">v</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">p0</span><span class="o">*</span><span class="n">noz</span><span class="o">.</span><span class="n">area_critic</span> \
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">k</span> <span class="o">/</span> <span class="n">task</span><span class="o">.</span><span class="n">R</span> <span class="o">/</span> <span class="n">task</span><span class="o">.</span><span class="n">T0</span><span class="p">)</span> \
        <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">v_out</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">v_out</span> <span class="o">+</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_a</span><span class="p">)</span>
    <span class="n">P_spec</span> <span class="o">=</span> <span class="n">P</span> <span class="o">/</span> <span class="n">G</span>
    <span class="n">P_space</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">v_out</span> <span class="o">+</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">P_space_spec</span> <span class="o">=</span> <span class="n">P_space</span> <span class="o">/</span> <span class="n">G</span>
    <span class="n">v_ideal</span> <span class="o">=</span> <span class="o">-</span><span class="n">P_space_spec</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">task</span><span class="o">.</span><span class="n">rel_propel_mass</span><span class="p">)</span>
    <span class="c1"># И в итоге возвращаем экземпляр Solution</span>
    <span class="k">return</span> <span class="n">Solution</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">mach</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">v_out</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">P</span><span class="p">,</span> <span class="n">P_spec</span><span class="p">,</span> <span class="n">P_space</span><span class="p">,</span> <span class="n">P_space_spec</span><span class="p">,</span> <span class="n">v_ideal</span><span class="p">,</span>
        <span class="n">p_a</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Запись</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">xi</span> <span class="o">&lt;</span> <span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>означает следующее.
Если <code class="docutils literal notranslate"><span class="pre">xi</span> <span class="pre">&lt;</span> <span class="pre">noz.x_critic</span></code> (конфузор сопла), то ищи корень (число Маха) на отрезке от <span class="math notranslate nohighlight">\(10^{-6}\)</span> до <span class="math notranslate nohighlight">\(1\)</span>, поскольку в конфузоре течение газа дозвуковое.
Иначе (в диффузоре) корень ищи на отрезке от <span class="math notranslate nohighlight">\(1\)</span> до <span class="math notranslate nohighlight">\(10\)</span> (просто большое значение).</p>
<p>Задав <code class="docutils literal notranslate"><span class="pre">bracket</span></code>, мы тем самым неявно выбрали метод Брента <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.brentq.html">brentq</a> в качестве алгоритма оптимизации.</p>
<section id="id3">
<h3>Тестовый расчёт<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Посчитаем тестовый вариант.
Для этого:</p>
<ol class="arabic simple">
<li><p>Создаём экземпляр задачи <code class="docutils literal notranslate"><span class="pre">Task</span></code>:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">radians</span>

<span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span>
    <span class="n">variant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">p0</span><span class="o">=</span><span class="mf">5.4e6</span><span class="p">,</span>     <span class="c1"># Па</span>
    <span class="n">T0</span><span class="o">=</span><span class="mi">2705</span><span class="p">,</span>    <span class="c1"># К</span>
    <span class="n">R</span><span class="o">=</span><span class="mi">325</span><span class="p">,</span>      <span class="c1"># Дж/(кг К)</span>
    <span class="n">k</span><span class="o">=</span><span class="mf">1.24</span><span class="p">,</span>
    <span class="n">d_critic</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>       <span class="c1"># м</span>
    <span class="n">area_ratio</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">d_chamber</span><span class="o">=</span><span class="mf">3.5</span><span class="o">*</span><span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># м</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">radians</span><span class="p">(</span><span class="mi">45</span><span class="p">),</span>  <span class="c1"># радианы</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">radians</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>    <span class="c1"># радианы</span>
    <span class="n">rel_propel_mass</span><span class="o">=</span><span class="mf">0.8</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Создаём экземпляр сопла <code class="docutils literal notranslate"><span class="pre">Nozzle</span></code>:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noz</span> <span class="o">=</span> <span class="n">Nozzle</span><span class="p">(</span>
    <span class="n">d_chamber</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">d_chamber</span><span class="p">,</span>
    <span class="n">d_critic</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">d_critic</span><span class="p">,</span>
    <span class="n">area_ratio</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">area_ratio</span><span class="p">,</span>
    <span class="n">confuser_angle</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
    <span class="n">diffuser_angle</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">beta</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>Вызываем решатель <code class="docutils literal notranslate"><span class="pre">solve</span></code>:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">noz</span><span class="p">,</span> <span class="n">p_a</span><span class="o">=</span><span class="mf">1e5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Смотрим результаты:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Давление на выходе, Па&#39;: 122502.34808174215,
 &#39;Массовый расход, кг/с&#39;: 1068.5320756512886,
 &#39;Скорость идеальной ракеты, м/с&#39;: 3809.111588743622,
 &#39;Скорость потока на выходе, м/с&#39;: 2172.24266404392,
 &#39;Степень нерасчётности сопла&#39;: &#39;0.8163108835536197 (недорасширение)&#39;,
 &#39;Тяга в пустоте, Н&#39;: 2528931.3000909286,
 &#39;Тяга, Н&#39;: 2359285.29679708,
 &#39;Удельная тяга в пустоте, м/с&#39;: 2366.7340997222773,
 &#39;Удельная тяга, м/с&#39;: 2207.9686240200654}
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Вывод очень большой ввиду того, что в решении хранится несколько массивов по 200 элементов каждый.
Но вы можете сравнить полученные значения тяг и скорости ракеты, а также степень нерасчётности сопла с результатами в методическом пособии (они совпадают).</p>
</div>
</section>
<section id="id4">
<h3>Визуализация результатов<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>Подключаем Matplotlib и строим графики:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">make_plots</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">noz</span><span class="p">:</span> <span class="n">Nozzle</span><span class="p">,</span> <span class="n">sol</span><span class="p">:</span> <span class="n">Solution</span><span class="p">):</span>
    <span class="c1"># Площадь</span>
    <span class="n">fig_s</span><span class="p">,</span> <span class="n">ax_s</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">)</span>
    <span class="n">ax_s</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_s</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_s</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$S(x)$, м$^2$&quot;</span><span class="p">)</span>
    <span class="n">ax_s</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Число Маха</span>
    <span class="n">fig_mach</span><span class="p">,</span> <span class="n">ax_mach</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;Mach&quot;</span><span class="p">)</span>
    <span class="n">ax_mach</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">mach</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_mach</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\mathrm</span><span class="si">{M}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">ax_mach</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_mach</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Безразмерная скорость</span>
    <span class="n">fig_lambda</span><span class="p">,</span> <span class="n">ax_lambda</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;lambda&quot;</span><span class="p">)</span>
    <span class="n">ax_lambda</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mach2lambda</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">mach</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">k</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_lambda</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\lambda$&quot;</span><span class="p">)</span>
    <span class="n">ax_lambda</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_lambda</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Давление</span>
    <span class="n">fig_p</span><span class="p">,</span> <span class="n">ax_p</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;pressure&quot;</span><span class="p">)</span>
    <span class="n">ax_p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">pressure</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_p</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$p$, МПа&quot;</span><span class="p">)</span>
    <span class="n">ax_p</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_p</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Плотность</span>
    <span class="n">fig_dens</span><span class="p">,</span> <span class="n">ax_dens</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;density&quot;</span><span class="p">)</span>
    <span class="n">ax_dens</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">density</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_dens</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho$, кг/м$^3$&quot;</span><span class="p">)</span>
    <span class="n">ax_dens</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_dens</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Температура</span>
    <span class="n">fig_temp</span><span class="p">,</span> <span class="n">ax_temp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;temperature&quot;</span><span class="p">)</span>
    <span class="n">ax_temp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_temp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$T$, К&quot;</span><span class="p">)</span>
    <span class="n">ax_temp</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_temp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Плотность потока массы</span>
    <span class="n">fig_j</span><span class="p">,</span> <span class="n">ax_j</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;j&quot;</span><span class="p">)</span>
    <span class="n">ax_j</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">specific_mass</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_j</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$j$, кг/(с $\cdot$ м$^2$)&quot;</span><span class="p">)</span>
    <span class="n">ax_j</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_j</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="c1"># Массовый расход</span>
    <span class="n">fig_G</span><span class="p">,</span> <span class="n">ax_G</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">)</span>
    <span class="n">ax_G</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">specific_mass</span><span class="o">*</span><span class="n">sol</span><span class="o">.</span><span class="n">square</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_G</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$, м&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$G$, кг/с&quot;</span><span class="p">)</span>
    <span class="n">ax_G</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">noz</span><span class="o">.</span><span class="n">x_critic</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax_G</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Вызываем и получаем:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s2">&quot;../sciart.mplstyle&quot;</span><span class="p">):</span>
    <span class="n">make_plots</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">noz</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cc807a4bdea933ccd4cd939b43ee397316cafcab63d94e61080696f34a4f0156.png" src="_images/cc807a4bdea933ccd4cd939b43ee397316cafcab63d94e61080696f34a4f0156.png" />
<img alt="_images/1c2cf171eb953fdeba08a78eb4e235ff7e0b4a313a06e8a084e46c37402a7a99.png" src="_images/1c2cf171eb953fdeba08a78eb4e235ff7e0b4a313a06e8a084e46c37402a7a99.png" />
<img alt="_images/0b73ccebf6f0ec688fa339ce472fa6adf0c4728ea9a443e212471cd6f5191be2.png" src="_images/0b73ccebf6f0ec688fa339ce472fa6adf0c4728ea9a443e212471cd6f5191be2.png" />
<img alt="_images/88060170aef9ee6ed63415a73bc25a074f50e9282773cab58754c7c8a8df48c7.png" src="_images/88060170aef9ee6ed63415a73bc25a074f50e9282773cab58754c7c8a8df48c7.png" />
<img alt="_images/ab8e6f64967f13e85172244e751640c8aae2892cb3c42d615577194c721c0170.png" src="_images/ab8e6f64967f13e85172244e751640c8aae2892cb3c42d615577194c721c0170.png" />
<img alt="_images/2e6898a2c994ed8c68b8f1efbc0df6245f99191cd5563d46c59e53f249045e01.png" src="_images/2e6898a2c994ed8c68b8f1efbc0df6245f99191cd5563d46c59e53f249045e01.png" />
<img alt="_images/98152d9a0c9a3056a5fc0509dd020d9befd539400b6472b73903fdcc3f1e0495.png" src="_images/98152d9a0c9a3056a5fc0509dd020d9befd539400b6472b73903fdcc3f1e0495.png" />
<img alt="_images/2efa42e1c676a6549dca1a7811fc19cf47e5003670b0c016a690fa5f406d737c.png" src="_images/2efa42e1c676a6549dca1a7811fc19cf47e5003670b0c016a690fa5f406d737c.png" />
</div>
</div>
<p>Разработанная программа не привязана к конкретному варианту.
Достаточно подставить исходные данные — и задача будет решена для них.
В этом и заключается основа автоматизации.</p>
<p>Вряд ли вы сейчас прочувствуете её важность и удобство.
Может показаться, что мы переусложнили код.
Его действительно можно написать в виде небольшого скрипта, как в методическом пособии.
Но когда вы начнёте делать работы без явно заданных исходных данных, когда вам нужно будет эти данные варьировать, анализировать — вот тогда автоматизация для вас заиграет новыми красками.</p>
</section>
</section>
<section id="id5">
<h2>Пересчёт длины сопла для обеспечения расчётного режима его работы<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>Реализуйте пересчёт длины сопла самостоятельно.
Напишите функцию</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adapt_nozzle</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">noz</span><span class="p">:</span> <span class="n">Nozzle</span><span class="p">,</span> <span class="n">p_a</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdaptedNozzle</span>
</pre></div>
</div>
<p>которая возвращает класс данных <code class="docutils literal notranslate"><span class="pre">AdaptedNozzle</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AdaptedNozzle</span><span class="p">:</span>
    <span class="n">mach_out</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">d_out</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">x_out</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">dx_percents</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>    <span class="c1"># &lt;- можете реализовать аналогично Solution</span>


<span class="k">def</span> <span class="nf">adapt_nozzle</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">noz</span><span class="p">:</span> <span class="n">Nozzle</span><span class="p">,</span> <span class="n">p_a</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdaptedNozzle</span><span class="p">:</span>
    <span class="c1"># Изменить длину сопла для обеспечения расчётного режима истечения.</span>
    <span class="k">pass</span> <span class="c1"># &lt;- вместо pass ваш код</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="gas-dynamics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Газодинамические функции</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Класс результатов решения <code class="docutils literal notranslate"><span class="pre">Solution</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Решающая функция</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Тестовый расчёт</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Визуализация результатов</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Пересчёт длины сопла для обеспечения расчётного режима его работы</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Vadim Fedulov
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>